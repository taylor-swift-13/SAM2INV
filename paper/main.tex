%%
%% SAM2INV: A Sampling-and-Filtering Framework with Offline Policy Exploration
%%          for Certified Loop Invariant Generation
%% ACM Conference Format
%%
\documentclass[sigconf,nonacm]{acmart}

%% Packages
\usepackage{booktabs}
%% algorithm/algorithmic not available in this TeX installation;
%% using a listing-based pseudocode style instead.
\usepackage{listings}
\usepackage{xcolor}
\usepackage{subcaption}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{pifont}

%% Listings style for C / ACSL
\lstdefinestyle{cstyle}{
  language=C,
  basicstyle=\ttfamily\small,
  keywordstyle=\color{blue}\bfseries,
  commentstyle=\color{gray}\itshape,
  stringstyle=\color{red},
  numbers=left,
  numberstyle=\tiny\color{gray},
  stepnumber=1,
  numbersep=5pt,
  backgroundcolor=\color{white},
  showspaces=false,
  showstringspaces=false,
  showtabs=false,
  frame=single,
  tabsize=2,
  captionpos=b,
  breaklines=true,
  breakatwhitespace=false,
  escapeinside={(*@}{@*)},
  morekeywords={loop,invariant,assigns,variant,requires,assert},
  literate={\\at}{{{\color{blue}\textbackslash at}}}3
           {\\forall}{{{\color{blue}\textbackslash forall}}}7
           {\\exists}{{{\color{blue}\textbackslash exists}}}7,
}
\lstset{style=cstyle}

%% Listings style for Coq
\lstdefinestyle{coqstyle}{
  language=,
  basicstyle=\ttfamily\small,
  keywordstyle=\color{blue}\bfseries,
  commentstyle=\color{gray}\itshape,
  numbers=left,
  numberstyle=\tiny\color{gray},
  frame=single,
  breaklines=true,
  morekeywords={Definition,forall,Proof,Qed,Lemma,Theorem,Require,Import},
}

%% Meta
\title{A Sampling-and-Filtering Framework with Offline Policy Exploration for Certified Loop Invariant Generation}

\author{Anonymous}
\affiliation{%
  \institution{Anonymous Institution}
}
\email{anonymous@example.com}

\begin{document}

%% Abstract
\begin{abstract}
Automatically synthesizing loop invariants remains a central challenge in formal software
verification.
We present \textsc{SAM2INV}, a system built around three contributions.
First, \textsc{LoopFactory}, a probabilistic DSL that generates structured numeric loop
programs with controllable arithmetic complexity, nesting depth, and variable count,
serves as the \emph{task input generator}: it supplies the programs that the downstream
pipeline annotates and that ultimately populate the training corpora.
Second, a \emph{three-stage sampling-and-filtering pipeline} combines large language
model~(LLM) candidate generation with progressively more expensive filters to produce
\emph{certified} ACSL loop invariant annotations for C programs, formally verified by
Frama-C/WP.
$N$ parallel LLM calls are issued and all returned candidate expressions are
\emph{unioned} into a single pool, which is then filtered through
(1)~an \emph{ACSL syntax filter} that rejects ill-formed expressions,
(2)~an \emph{execution-trace semantic filter} that discards candidates falsified by any
observed loop state, and
(3)~\emph{Houdini formal pruning} via Frama-C/WP that removes non-inductive candidates,
converging to the strongest certified inductive conjunction the union supports.
Crucially, the filtering pipeline alone---before any fine-tuning---already yields
substantial improvements in success rate and invariant quality over a single-call baseline.
Third, the pipeline naturally produces \emph{offline SFT and DPO training data} at no
extra cost: every certified annotation becomes an SFT record, and every rejected
candidate---labelled by the stage at which it was filtered---forms a DPO preference pair.
This stage-stratified labelling avoids reward hacking and requires no online
reinforcement learning.
Running \textsc{LoopFactory} and this pipeline together at scale constitutes the training
data generation workflow.
\end{abstract}

\maketitle

%% ============================================================
\input{sections/introduction}
\input{sections/related}
\input{sections/overview}
\input{sections/method}
\input{sections/loop_factory}
\input{sections/experiments}
\input{sections/conclusion}
\input{sections/appendix}
%% ============================================================

\bibliographystyle{ACM-Reference-Format}
\bibliography{references}

\end{document}
